<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      background: skyblue;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// --- Game constants ---
let SCREEN_WIDTH = window.innerWidth;
let SCREEN_HEIGHT = window.innerHeight;
canvas.width = SCREEN_WIDTH;
canvas.height = SCREEN_HEIGHT;

const BASE_WIDTH = 500;
const BASE_HEIGHT = 700;

let GRAVITY = 0.25;
let FLAP_STRENGTH = -6.5;
let PIPE_SPEED = 2;
let PIPE_WIDTH = 80;
let PIPE_GAP = 200;
let spawnInterval = 300;
let deviceScale = 1;

// --- Game variables ---
let bird, pipes, score, lastTime, gameState, spawnTimer;

// --- Bird ---
class Bird {
  constructor(){
    this.x = SCREEN_WIDTH/4;
    this.y = SCREEN_HEIGHT/2;
    this.width = 40;
    this.height = 40;
    this.velocity = 0;
  }
  flap(){
    this.velocity = FLAP_STRENGTH * deviceScale;
  }
  update(deltaTime){
    this.velocity += GRAVITY * deltaTime * 60 * deviceScale;
    this.y += this.velocity * deltaTime * 60 * deviceScale;
  }
  draw(){
    ctx.fillStyle = "yellow";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
  getRect(){
    return {x:this.x,y:this.y,w:this.width,h:this.height};
  }
}

// --- Pipe ---
class Pipe {
  constructor(){
    this.x = SCREEN_WIDTH;
    this.width = PIPE_WIDTH;
    this.topHeight = Math.random()*(SCREEN_HEIGHT-PIPE_GAP-100)+50;
    this.bottomY = this.topHeight + PIPE_GAP;
    this.passed = false;
  }
  update(deltaTime){
    this.x -= PIPE_SPEED * deltaTime * 60 * deviceScale;
  }
  draw(){
    ctx.fillStyle = "green";
    ctx.fillRect(this.x,0,this.width,this.topHeight);
    ctx.fillRect(this.x,this.bottomY,this.width,SCREEN_HEIGHT-this.bottomY);
  }
  getRects(){
    return [
      {x:this.x,y:0,w:this.width,h:this.topHeight},
      {x:this.x,y:this.bottomY,w:this.width,h:SCREEN_HEIGHT-this.bottomY}
    ];
  }
}

// --- Helpers ---
function rectsCollide(r1,r2){
  return !(r1.x+r1.w<r2.x || r1.x>r2.x+r2.w || r1.y+r1.h<r2.y || r1.y>r2.y+r2.h);
}

function drawText(text,x,y,size){
  ctx.fillStyle="white";
  ctx.font = `${size}px sans-serif`;
  ctx.textAlign="center";
  ctx.fillText(text,x,y);
}

function resetGame(){
  bird = new Bird();
  pipes = [];
  score = 0;
  spawnTimer = 0;
  gameState="menu";
}

function drawGameOver(){
  ctx.fillStyle="rgba(0,0,0,0.5)";
  ctx.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT);
  drawText("GAME OVER", SCREEN_WIDTH/2, SCREEN_HEIGHT/3, 60);
  drawText(`Final Score: ${score}`, SCREEN_WIDTH/2, SCREEN_HEIGHT/2, 40);
  drawText("Tap/Click or SPACE to Restart", SCREEN_WIDTH/2, SCREEN_HEIGHT*2/3, 30);
}

// --- Device scaling ---
function updateDeviceScale(){
  if(SCREEN_WIDTH <= 768){ // mobile
    deviceScale = 0.85; // faster than before, balanced
  } else {
    deviceScale = 1;    // desktop baseline
  }
}

function updateProportions(){
  SCREEN_WIDTH = window.innerWidth;
  SCREEN_HEIGHT = window.innerHeight;
  canvas.width = SCREEN_WIDTH;
  canvas.height = SCREEN_HEIGHT;

  let scale = Math.min(SCREEN_WIDTH/BASE_WIDTH, SCREEN_HEIGHT/BASE_HEIGHT);

  bird.width = Math.max(40*scale, 30);
  bird.height = Math.max(40*scale, 30);

  if(SCREEN_WIDTH <= 768){
    PIPE_WIDTH = Math.max(65*scale, 50);
    PIPE_GAP = Math.max(220*scale, 160);      // slightly smaller than before
    spawnInterval = Math.max(260*scale, 180); // pipes spawn a bit faster
  } else {
    PIPE_WIDTH = Math.max(80*scale, 50);
    PIPE_GAP = Math.max(200*scale, 150);
    spawnInterval = Math.max(300*scale, 150);
  }

  pipes.forEach(pipe => pipe.width = PIPE_WIDTH);
}

// --- Game loop ---
function gameLoop(timestamp){
  if(!lastTime) lastTime = timestamp;
  let deltaTime = (timestamp - lastTime)/1000;
  lastTime = timestamp;

  ctx.fillStyle="skyblue";
  ctx.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT);

  if(gameState==="menu"){
    drawText("Flappy Bird", SCREEN_WIDTH/2, SCREEN_HEIGHT/4, 60);
    drawText("Tap/Click or SPACE to play", SCREEN_WIDTH/2, SCREEN_HEIGHT/2, 30);
  }
  else if(gameState==="playing"){
    bird.update(deltaTime);
    bird.draw();

    spawnTimer += deltaTime*1000;
    if(spawnTimer > spawnInterval){
      pipes.push(new Pipe());
      spawnTimer = 0;
    }

    for(let pipe of pipes){
      pipe.update(deltaTime);
      pipe.draw();

      let birdRect = bird.getRect();
      for(let r of pipe.getRects()){
        if(rectsCollide(birdRect,r)){
          gameState="gameover";
        }
      }

      if(!pipe.passed && pipe.x+pipe.width<bird.x){
        pipe.passed=true;
        score++;
      }
    }

    pipes = pipes.filter(p=>p.x+p.width>0);

    if(bird.y+bird.height>SCREEN_HEIGHT || bird.y<0){
      gameState="gameover";
    }

    drawText(score, 50, 50, 40);
  }
  else if(gameState==="gameover"){
    pipes.forEach(p=>p.draw());
    bird.draw();
    drawGameOver();
  }

  requestAnimationFrame(gameLoop);
}

// --- Input ---
document.addEventListener('keydown', e=>{
  if(e.code==="Space"){
    if(gameState==="menu" || gameState==="gameover"){ resetGame(); gameState="playing"; }
    else if(gameState==="playing"){ bird.flap(); }
  }
});
canvas.addEventListener('mousedown', ()=>{
  if(gameState==="menu" || gameState==="gameover"){ resetGame(); gameState="playing"; }
  else if(gameState==="playing"){ bird.flap(); }
});
canvas.addEventListener('touchstart', e=>{
  e.preventDefault();
  if(gameState==="menu" || gameState==="gameover"){ resetGame(); gameState="playing"; }
  else if(gameState==="playing"){ bird.flap(); }
},{passive:false});

// --- Start ---
resetGame();
updateDeviceScale();
updateProportions();
window.addEventListener('resize', ()=>{ updateProportions(); updateDeviceScale(); });
requestAnimationFrame(gameLoop);
</script>
</body>
</html>