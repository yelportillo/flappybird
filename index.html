<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy Bird</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
html, body { margin:0; padding:0; height:100%; background:#000; overflow:hidden; }
canvas { display:block; margin:0 auto; background:#000; }
#playBtn {
  position: absolute; left:50%; top:50%;
  transform: translate(-50%, -50%);
  font-size:28px; padding:12px 20px;
  background:#0a8b2f; color:#fff; border:none; border-radius:8px;
  cursor:pointer; z-index:50;
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="playBtn">PLAY</button>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const playBtn = document.getElementById('playBtn');

// Game variables
let GRAVITY = 0.5;
let FLAP = -10;
let PIPE_SPEED = 3;
let PIPE_GAP = 200;
let FPS = 60;

let bird = { x:0, y:0, w:0, h:0, v:0 };
let pipes = [];
let spawnTimer = 0;
let score = 0;
let state = 'menu';
let lastTime = 0;

// Assets
let bg = new Image(), birdImg = new Image(), pipeImg = new Image();
bg.src = 'assets/background.png';
birdImg.src = 'assets/bird.png';
pipeImg.src = 'assets/pipe.png';

// Sounds
let wing = new Audio('assets/sounds/wing.wav');
let hit = new Audio('assets/sounds/hit.wav');
let point = new Audio('assets/sounds/point.wav');

function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    bird.w = canvas.width/12;
    bird.h = bird.w * 0.75;
    bird.x = canvas.width*0.2;
    bird.y = canvas.height/2 - bird.h/2;
    PIPE_GAP = canvas.height*0.25;
}
window.addEventListener('resize', resize);
resize();

function resetGame(){
    bird.v = 0;
    bird.y = canvas.height/2 - bird.h/2;
    pipes = [];
    spawnTimer = 0;
    score = 0;
}

function flapBird(){ bird.v = FLAP; wing.play(); }

function spawnPipe(){
    let topH = Math.random()*(canvas.height - PIPE_GAP - 100)+50;
    pipes.push({x:canvas.width, topH:topH, bottomY:topH+PIPE_GAP, w:canvas.width/5, passed:false});
}

function update(dt){
    if(state!=='playing') return;
    bird.v += GRAVITY;
    bird.y += bird.v;

    spawnTimer++;
    if(spawnTimer>90){ spawnPipe(); spawnTimer=0; }

    for(let i=pipes.length-1;i>=0;i--){
        let p=pipes[i];
        p.x -= PIPE_SPEED;
        // Collision
        if(bird.x + bird.w > p.x && bird.x < p.x + p.w){
            if(bird.y < p.topH || bird.y + bird.h > p.bottomY){
                hit.play();
                state='gameover';
            }
        }
        if(!p.passed && bird.x > p.x+p.w){ p.passed=true; score++; point.play(); }
        if(p.x+p.w<0) pipes.splice(i,1);
    }

    if(bird.y + bird.h>=canvas.height || bird.y<=0){ hit.play(); state='gameover'; }
}

function draw(){
    // Background
    if(bg.complete) ctx.drawImage(bg,0,0,canvas.width,canvas.height);
    else ctx.fillStyle='#70c5ce',ctx.fillRect(0,0,canvas.width,canvas.height);

    // Pipes
    for(let p of pipes){
        ctx.save(); ctx.translate(p.x+p.w/2,p.topH/2); ctx.scale(1,-1);
        if(pipeImg.complete) ctx.drawImage(pipeImg,-p.w/2,-p.topH/2,p.w,p.topH);
        ctx.restore();
        if(pipeImg.complete) ctx.drawImage(pipeImg,p.x,p.bottomY,p.w,canvas.height-p.bottomY);
    }

    // Bird
    if(birdImg.complete) ctx.drawImage(birdImg,bird.x,bird.y,bird.w,bird.h);

    // Score
    ctx.fillStyle='#fff'; ctx.font=`${Math.floor(canvas.width*0.05)}px sans-serif`;
    ctx.fillText(score, 20, Math.floor(canvas.height*0.08));

    // Menu or Game Over
    if(state==='menu'){
        ctx.fillStyle='yellow'; ctx.font=`${Math.floor(canvas.width*0.08)}px sans-serif`;
        ctx.fillText('Flappy Bird', canvas.width/2-150, canvas.height/3);
    }
    if(state==='gameover'){
        ctx.fillStyle='red'; ctx.font=`${Math.floor(canvas.width*0.08)}px sans-serif`;
        ctx.fillText('GAME OVER', canvas.width/2-150, canvas.height/2-20);
    }
}

function loop(now){
    let dt = (now-lastTime)/1000; lastTime=now;
    update(dt); draw();
    if(state==='playing') requestAnimationFrame(loop);
}

playBtn.addEventListener('click',()=>{
    if(state==='menu' || state==='gameover'){ resetGame(); state='playing'; playBtn.style.display='none'; lastTime=performance.now(); requestAnimationFrame(loop);}
});
window.addEventListener('keydown', e=>{ if(e.code==='Space'){ if(state==='playing')flapBird(); else if(state==='menu'){ resetGame(); state='playing'; playBtn.style.display='none'; lastTime=performance.now(); requestAnimationFrame(loop); } }});
window.addEventListener('mousedown', ()=>{ if(state==='playing')flapBird(); else if(state==='menu'){ resetGame(); state='playing'; playBtn.style.display='none'; lastTime=performance.now(); requestAnimationFrame(loop); }});
window.addEventListener('touchstart', e=>{ e.preventDefault(); if(state==='playing')flapBird(); else if(state==='menu'){ resetGame(); state='playing'; playBtn.style.display='none'; lastTime=performance.now(); requestAnimationFrame(loop); }},{passive:false});
</script>
</body>
</html>
