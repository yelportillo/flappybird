<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Flappy Bird</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1" />
<style>
html,body { margin:0; padding:0; height:100%; background:#000; overflow:hidden; touch-action:none; }
canvas { display:block; background:#000; margin:0 auto; }
#playBtn {
  position: absolute;
  left: 50%; top: 50%;
  transform: translate(-50%,-50%);
  font-size: 28px; padding:12px 20px;
  background:#0a8b2f; color:#fff; border:none; border-radius:8px;
  cursor:pointer; z-index:50;
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="playBtn">PLAY</button>

<script>
/* ---------- Config ---------- */
const GRAVITY = 0.35;
const FLAP = -8;
const PIPE_SPEED = 2.5;
const SPAWN_FRAMES = 150;
const PIPE_GAP_RATIO = 0.25;  // 1/4 of screen height

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const playBtn = document.getElementById('playBtn');

let assets = { bird: new Image(), pipe: new Image(), bg: new Image() };
assets.bird.src = 'assets/bird.png';
assets.pipe.src = 'assets/pipe.png';
assets.bg.src = 'assets/background.png';

// Sounds
let wingSound = new Audio('assets/sounds/wing.wav');
let hitSound  = new Audio('assets/sounds/hit.wav');
let pointSound = new Audio('assets/sounds/point.wav');
let soundsEnabled = false;
function enableSounds() {
  if (!soundsEnabled) {
    wingSound.play().catch(()=>{});
    wingSound.pause(); wingSound.currentTime = 0;
    soundsEnabled = true;
  }
}

/* ---------- Responsive Sizes ---------- */
let VIS = { birdW:40, birdH:30, pipeW:100, pipeGap:150 };
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  VIS.pipeW = Math.floor(canvas.width / 5);         // bigger pipes
  VIS.pipeGap = Math.floor(canvas.height * PIPE_GAP_RATIO); // normal gap
  VIS.birdW = Math.floor(canvas.width / 12);
  VIS.birdH = VIS.birdW * 0.75;
}
window.addEventListener('resize', resize);

/* ---------- Game State ---------- */
let state = 'menu';
let bird = {};
let pipes = [];
let spawnTimer = 0;
let score = 0;

function resetBird() {
  bird.x = Math.floor(canvas.width * 0.2);
  bird.y = Math.floor(canvas.height / 2 - VIS.birdH/2);
  bird.w = VIS.birdW;
  bird.h = VIS.birdH;
  bird.v = 0;
}
function startPlaying() {
  state = 'playing';
  pipes = [];
  spawnTimer = 0;
  score = 0;
  resetBird();
  playBtn.style.display = 'none';
  lastTime = performance.now();
  requestAnimationFrame(loop);
}
function showMenu() {
  state = 'menu';
  playBtn.style.display = 'block';
  playBtn.innerText = 'PLAY';
}
function gameOver() {
  state = 'gameover';
  playBtn.innerText = 'RESTART';
  playBtn.style.display = 'block';
}

/* ---------- Game ---------- */
function spawnPipe() {
  const topH = Math.floor(Math.random()*(canvas.height - VIS.pipeGap - 100) + 50);
  pipes.push({ x: canvas.width, w: VIS.pipeW, topH: topH, bottomY: topH+VIS.pipeGap, passed:false });
}
function update(dt) {
  const dtNorm = dt * 60;
  if (state !== 'playing') return;
  bird.v += GRAVITY * dtNorm;
  bird.y += bird.v * dtNorm * 0.0167;
  spawnTimer += dtNorm;
  if (spawnTimer > SPAWN_FRAMES) { spawnPipe(); spawnTimer=0; }
  for (let i=pipes.length-1;i>=0;i--) {
    const p = pipes[i];
    p.x -= PIPE_SPEED * dtNorm;
    const pad=5, bx=bird.x+pad, by=bird.y+pad, bw=bird.w-pad*2, bh=bird.h-pad*2;
    if (bx < p.x+p.w && bx+bw > p.x) {
      if (by < p.topH || by+bh > p.bottomY) {
        if (soundsEnabled) { hitSound.currentTime=0; hitSound.play(); }
        return gameOver();
      }
    }
    if (!p.passed && bird.x > p.x+p.w) {
      p.passed=true; score++; if(soundsEnabled){pointSound.currentTime=0;pointSound.play();}
    }
    if (p.x+p.w<0) pipes.splice(i,1);
  }
  if (bird.y+bird.h>=canvas.height || bird.y<=0) {
    if (soundsEnabled) { hitSound.currentTime=0; hitSound.play(); }
    return gameOver();
  }
}
function draw() {
  // Background
  if (assets.bg.complete) ctx.drawImage(assets.bg,0,0,canvas.width,canvas.height);
  else ctx.fillStyle='#70c5ce',ctx.fillRect(0,0,canvas.width,canvas.height);

  // Pipes
  for (let p of pipes) {
    ctx.save();
    ctx.translate(p.x+p.w/2,p.topH/2); ctx.scale(1,-1);
    if (assets.pipe.complete) ctx.drawImage(assets.pipe,-p.w/2,-p.topH/2,p.w,p.topH);
    ctx.restore();
    if (assets.pipe.complete) ctx.drawImage(assets.pipe,p.x,p.bottomY,p.w,canvas.height-p.bottomY);
  }

  // Bird
  if (assets.bird.complete) ctx.drawImage(assets.bird,bird.x,bird.y,bird.w,bird.h);

  // Score
  ctx.fillStyle='#fff'; 
  ctx.font=`${Math.max(20,Math.floor(canvas.width*0.05))}px sans-serif`;
  ctx.fillText(score, 20, Math.floor(canvas.height*0.08));

  // Game Over
  if(state==='gameover') {
    ctx.fillStyle='red';
    ctx.font=`${Math.max(40,Math.floor(canvas.width*0.08))}px sans-serif`;
    ctx.fillText('GAME OVER',canvas.width/2-150,canvas.height/2-20);
  }

  // Main menu title
  if(state==='menu') {
    ctx.fillStyle='yellow';
    ctx.font=`${Math.max(40,Math.floor(canvas.width*0.08))}px sans-serif`;
    ctx.fillText('Flappy Bird',canvas.width/2-150,canvas.height/3);
  }
}

/* ---------- Loop ---------- */
let lastTime = performance.now();
function loop(now){
  const dt = (now-lastTime)/1000; lastTime=now;
  update(dt); draw();
  if(state==='playing') requestAnimationFrame(loop);
}

/* ---------- Input ---------- */
function flap() {
  bird.v = FLAP; if(soundsEnabled){wingSound.currentTime=0;wingSound.play();}
}
playBtn.addEventListener('click',()=>{enableSounds(); if(state==='menu')startPlaying(); else if(state==='gameover')startPlaying();});
window.addEventListener('keydown',(e)=>{ if(e.code==='Space'){enableSounds(); if(state==='menu')startPlaying(); else if(state==='playing')flap();}});
window.addEventListener('mousedown',()=>{enableSounds(); if(state==='menu')startPlaying(); else if(state==='playing')flap();});
window.addEventListener('touchstart',(e)=>{ e.preventDefault(); enableSounds(); if(state==='menu')startPlaying(); else if(state==='playing')flap();},{passive:false});

/* ---------- Init ---------- */
resize(); showMenu();
</script>
</body>
</html>
